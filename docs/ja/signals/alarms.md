# アラーム

アラームとは、プローブ、モニター、または指定した閾値を超えた値の変化の状態を指します。簡単な例としては、ディスクがいっぱいになったときや Web サイトがダウンしたときに電子メールを送信するアラームがあります。より高度なアラームは完全にプログラム化されており、自動スケーリングやサーバークラスター全体の作成などの複雑な対話を行うために使用されます。

ただし、ユースケースに関係なく、アラームはメトリクスの現在の *状態* を示します。この状態は、対象のシステムによって `OK`、`WARNING`、`ALERT`、または `NO DATA` になります。

アラームはある期間にわたってこの状態を反映し、時系列の上に構築されています。したがって、時系列から *派生* しています。下の図は、警告しきい値のアラームと、この時系列の平均値を示すアラームの 2 つのアラームを示しています。この図に示されているトラフィック量から、警告しきい値のアラームは、定義された値を下回るときに違反状態になるはずです。

![2 つのアラームを持つ時系列](../images/cwalarm2.png)

!!! info
	アラームの目的は、アクション (人間またはプログラムによる) をトリガーするか、しきい値が違反されたことを通知する (情報提供) かのいずれかです。アラームは、メトリクスのパフォーマンスに関する洞察を提供します。

## アクションが必要なものに対してアラートを設定する

アラート疲労とは、多くのアラートを受け取るため、人々がアラートを無視するようになる状況のことです。これは適切にモニタリングされているシステムの兆候ではありません。むしろ、これはアンチパターンです。

!!! success
	アクションが必要なものに対してアラートを作成し、常に [目的](../../guides/#monitor-what-matters) から逆算して作業する必要があります。

例えば、高速なレスポンスタイムが必要なウェブサイトを運用している場合、レスポンスタイムが特定の閾値を超えたときにアラートを配信するよう設定します。また、パフォーマンスの低下が CPU 使用率の高さに起因することが分かっている場合は、問題が発生する前に、そのデータポイントに対して *積極的に* アラートを設定します。ただし、環境内のすべての場所の CPU 使用率に対してアラートを設定する必要はないかもしれません。なぜなら、それが *結果に影響を与えない* 場合があるからです。

!!! success
	アラートが不要な場合、または自動化されたプロセスをトリガーする必要がない場合は、アラートを設定する必要はありません。不要なアラートからの通知は削除する必要があります。

## "すべてが OK" アラームに注意

同様に、一般的なパターンは "すべてが OK" アラームです。オペレーターは常にアラートを受け取るのに慣れすぎているため、突然何も通知がなくなったときにしか気づきません。これは非常に危険な運用モードであり、[オペレーショナルエクセレンス](../../faq/#what-is-operational-excellence)に反するパターンです。

!!! warning
	"すべてが OK" アラームは通常、人間が解釈する必要があります。これにより、自己修復アプリケーションなどのパターンが不可能になります。[^1]

## 集約によってアラーム疲労を防ぐ

オブザーバビリティは技術の問題ではなく、*人間の* 問題です。そのため、アラーム戦略は新しいアラームを作成するのではなく、アラームを減らすことに焦点を当てるべきです。テレメトリ収集を実装すると、環境からのアラートが増えるのは自然なことです。ただし、[対処可能なことにのみアラートを出す](../../signals/alarms/#alert-on-things-that-are-actionable) ように注意してください。アラートの原因となった状況に対処できない場合は、それを報告する必要はありません。

これは例で最もよく示されます。5 台の Web サーバーがバックエンドのデータベースを 1 つ共有している場合、データベースがダウンすると Web サーバーにどうなるでしょうか? 多くの人の答えは、*少なくとも 6 つ* のアラートが発生することです。*5 つ* は Web サーバー、*1 つ* はデータベースです。

![Six alarms](../images/alarm3.png)

しかし、配信する意味のあるアラートは 2 つだけです。

1. Web サイトがダウンしている
2. データベースがその原因である

![Two alarms](../images/alarm4.png)

!!! success
	アラートを集約すると、人間が理解しやすくなり、さらにランブックや自動化を作成しやすくなります。

## 既存の ITSM とサポートプロセスを利用する

モニタリングとオブザーバビリティのプラットフォームに関係なく、現在のツールチェーンに統合する必要があります。

!!! success
	アラートからこれらのツールへのプログラム的な統合を使用して、トラブルチケットと課題を作成することで、人的作業を排除し、プロセスを合理化できます。

これにより、[DORA メトリクス](https://en.wikipedia.org/wiki/DevOps)などの重要な運用データを取得できます。


[^1]: このパターンの詳細については、https://aws.amazon.com/jp/blogs/news/building-self-healing-infrastructure-as-code-with-dynatrace-aws-lambda-and-aws-service-catalog/ を参照してください。
