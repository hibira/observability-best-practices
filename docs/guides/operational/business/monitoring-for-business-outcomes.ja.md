# なぜオブザーバビリティが必要なのか

YouTube の [Developing an Observability Strategy](https://www.youtube.com/watch?v=Ub3ATriFapQ) をご覧ください。

## 本当に重要なことは?

職場で行うすべてのことは、組織のミッションに合致している必要があります。雇用されているすべての人は、組織のミッションの達成とビジョンの実現に向けて働いています。Amazon では、ミッションは次のように定義されています。

> Amazon は、地球で最も顧客中心的な企業、最高の雇用主、最も安全な職場を目指しています。

— [Amazon について](https://www.aboutamazon.com/about-us)

IT において、すべてのプロジェクト、デプロイ、セキュリティ対策、最適化は、ビジネスの成果につながる必要があります。当然のことのようでいて、ビジネスに価値を付加しないことは何一つやるべきではありません。ITIL の言葉を借りれば:


> すべての変更はビジネス価値を提供する必要がある

— ITIL サービス移行、AXELOS、2011年、44ページ
— [クラウドにおける変更管理のホワイトペーパー](https://docs.aws.amazon.com/whitepapers/latest/change-management-in-the-cloud/change-management-in-the-cloud.html) を参照

ミッションとビジネス価値は、行うすべてのことの基準となるため重要です。
オブザーバビリティには多くのメリットがあります。

- 可用性の向上
- 信頼性の向上 
- アプリケーションの健全性とパフォーマンスの理解
- コラボレーションの改善
- 問題の予防的検知
- 顧客満足度の向上
- 上市までの期間の短縮
- 運用コストの削減
- 自動化

これらのメリットはすべて共通点があり、顧客に直接的または組織に間接的にビジネス価値を提供します。
オブザーバビリティを考える際、すべてはアプリケーションがビジネス価値を提供しているかどうかに帰着します。

つまり、オブザーバビリティは、ビジネス価値の提供に貢献するものを測定し、ビジネスの成果とそのリスクに焦点を当てる必要があります。顧客が何を望み、何が必要かを考える必要があります。

## どこから始めればいいですか?

重要なことがわかったところで、何を測定する必要があるかを考える必要があります。Amazon では、お客様から逆算することから始めています。

> 私たちは内部的にサービスの改善を促されており、必要に迫られる前にメリットや機能を追加しています。値下げやお客様への付加価値の提供も、必要に迫られる前に行っています。必要に迫られる前に新しいことを生み出しています。 

— ジェフ・ベゾス、[2012年 株主への手紙](https://s2.q4cdn.com/299287126/files/doc_financials/annual/2012-Shareholder-Letter.pdf)

簡単な例として、EC サイトを使って説明しましょう。まず、オンラインで商品を購入する際に、お客様として何を望んでいるかを考えてみてください。人によって同じとは限りませんが、おそらくこうしたことを大切にしているでしょう。

- 配送
- 価格
- セキュリティ 
- ページの速度
- 検索 (探している商品が見つかるか)

お客様が大切にしていることがわかったら、それらを測定し、ビジネスの結果にどのように影響しているかを確認できるようになります。ページの速度は、コンバージョン率や検索エンジンのランキングに直接影響します。2017年の調査では、モバイルユーザーの53%が3秒以上の読み込み時間の場合にそのページを放棄することが示されています。もちろん、ページ速度の重要性を示す研究は他にも多数あります。測定する必要がある明白な指標ですが、コンバージョンへの影響や改善のためのデータを得ることができるので、測定してアクションを起こす必要があります。

## 逆から考える

お客様が大切にしていることすべてを知ることは期待できません。これを読んでいるあなたは、技術系の役割にいると思います。組織のステークホルダーと話をして、重要なことを測定していることを確認する必要があります。これは必ずしも簡単なことではありませんが、不可欠なことです。

EC サイトを例に考えてみましょう。今回は検索についてです。商品を購入するためには検索が必要であることは明白ですが、[Forrester Research のレポート](https://www.forrester.com/report/MustHave+eCommerce+Features/-/E-RES89561) によると、訪問者の 43% が即座に検索ボックスに移動し、検索経由のコンバージョン率は非検索ユーザーの 2-3 倍高いことをご存知でしょうか。検索は本当に重要で、うまく機能させる必要があり、監視する必要があります。ある検索で結果が全く得られないことを発見し、単純なパターンマッチングから自然言語処理へ移行する必要があるかもしれません。これはビジネスの結果を監視し、顧客体験を改善する例です。 

Amazon では次のようにしています。

> 私たちは顧客を深く理解し、彼らの痛みの原因から出発して迅速にイノベーションを開発し、彼らの人生に意味のあるソリューションを生み出そうと努めています。

— Daniel Slater - Worldwide Lead, Culture of Innovation, AWS in [Elements of Amazon’s Day 1 Culture](https://aws.amazon.com/executive-insights/content/how-amazon-defines-and-operationalizes-a-day-1-culture/)

私たちは顧客から始め、彼らのニーズから逆算しています。これはビジネスで成功する唯一のアプローチではありませんが、オブザーバビリティにとっては良いアプローチです。ステークホルダーと協力して、お客様にとって何が重要かを理解し、そこから逆算していきます。

付加価値として、お客様とステークホルダーにとって重要なメトリクスを収集することで、これらをリアルタイムのダッシュボードで可視化し、「ランディングページの読み込みにどのくらいの時間がかかっているか」や「ウェブサイトの運用にどのくらいのコストがかかっているか」といったレポートの作成や質問への対応を避けることができます。ステークホルダーや経営陣は、この情報をセルフサービスで入手できる必要があります。

これらは、アプリケーションにとって**本当に重要な**高レベルのメトリクスであり、ほとんどの場合、問題がある最良の指標でもあります。 たとえば、通常期待されるよりも注文数が少ないことを示すアラートは、おそらく顧客に影響を与えている問題があることを意味しています。サーバーのボリュームがほぼ満杯であることや、特定のサービスで多数の 5xx エラーが発生していることを示すアラートは、修正が必要なものかもしれませんが、まずは顧客への影響を理解して優先順位を決定する必要があります。これには時間がかかる場合があります。

これらの高レベルなビジネスメトリクスを測定することで、顧客に影響を与える問題は簡単に特定できます。これらのメトリクスは**何が**起こっているかを表しています。他のメトリクスやトレース、ログなどの他の可観測性の形態は、**なぜ**これが起こっているのかを表しており、これを修正または改善するために何ができるかを導き出します。

## 観測するもの

ここで、お客様にとって何が重要かというアイデアが得られました。これに基づき、Key Performance Indicator(KPI)を特定できます。これらはビジネスの成果にリスクがあるかどうかを判断する上位メトリクスです。また、それらの KPI に影響を与える可能性のあるさまざまなソースからの情報を収集する必要があります。これが、それらの KPI に影響を与える可能性のあるメトリクスについて考え始める必要がある場所です。前述のとおり、5xx エラーの数は影響を示すものではありませんが、KPI に影響を与える可能性があります。ビジネスの成果に影響を与えるものから、ビジネスの成果に影響を与える可能性のあるものへと逆向きに検討していきます。

収集する必要があるものがわかったら、KPI を測定し、それらの KPI に影響を与える可能性のある関連メトリクスを提供する情報ソースを特定する必要があります。これが観測するものの基本です。 

このデータはおそらく、メトリクス、ログ、トレースから得られるでしょう。このデータが得られたら、成果にリスクがある場合にアラートを出すことができます。

その後、影響を評価し、問題を修正しようと試みることができます。ほとんどの場合、このデータは、分離された技術的メトリクス(CPU やメモリなど)よりも前に、問題があることを教えてくれます。

オブザーバビリティを使って、ビジネスの成果に影響を与えている問題を反応的に修正したり、顧客の検索エクスペリエンスを改善するなどのようにデータを先取り的に利用することができます。

## まとめ

CPU、RAM、ディスク容量などの技術的なメトリクスは、スケーリング、パフォーマンス、容量、コストの面で重要ですが、アプリケーションの状況や顧客体験の洞察を示すものではありません。

重要なのはお客様であり、監視すべきはお客様の体験です。

そのため、お客様の要件から逆算し、ステークホルダーと協力して、重要な KPI とメトリクスを確立する必要があります。
